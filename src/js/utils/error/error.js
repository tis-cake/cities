import { AppRoute, HttpCode } from '../../const';
import { ActionCreator } from '../../store/actions';

import './error.css';

const TIMEOUT = 800;
const TIMEOUT_COEFFICIENT = 4;

const onErrorShowModal = (errorStatus, errorText) => {
  const node = document.createElement('div');
  node.classList.add('error-modal');
  node.textContent = `Ooops! Error status: ${errorStatus}. Error text: ${errorText}.`;

  document.body.insertAdjacentElement('afterbegin', node);

  setTimeout(() => {
    node.remove();
  }, TIMEOUT * TIMEOUT_COEFFICIENT);
};

const handleError = (error, dispatch) => {
  const { response } = error;
  const { status, statusText } = response;

  if (status === HttpCode.UNAUTHORIZED) {
    dispatch(ActionCreator.redirectToRoute(AppRoute.LOGIN));

    return;
  }

  onErrorShowModal(status, statusText);
};

export { handleError };
